version: '3.8'

# Development override configuration
# Usage: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  # ===========================================
  # PostgreSQL - Development
  # ===========================================
  postgres:
    ports:
      - "5432:5432"

  # ===========================================
  # MinIO - Development (Console exposed)
  # ===========================================
  minio:
    ports:
      - "9000:9000"
      - "9001:9001"

  # ===========================================
  # Backend - Development (Hot reload)
  # ===========================================
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.dev
    volumes:
      - ./backend/src:/app/src:ro
      - ./backend/build.gradle.kts:/app/build.gradle.kts:ro
    environment:
      SPRING_PROFILES_ACTIVE: dev
      SPRING_DEVTOOLS_RESTART_ENABLED: "true"
    ports:
      - "8080:8080"
      - "5005:5005"  # Debug port

  # ===========================================
  # Frontend - Development (Hot reload)
  # ===========================================
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev
    volumes:
      - ./frontend/src:/app/src
      - ./frontend/public:/app/public
    environment:
      NODE_ENV: development
      WATCHPACK_POLLING: "true"
    ports:
      - "3000:3000"

  # ===========================================
  # Nginx - Disabled in development
  # ===========================================
  nginx:
    profiles:
      - production
